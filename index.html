<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Gu√≠a de estudio a entrenador MC</title>
<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(to bottom right, #fffdf5, #fff);
    color: #222;
    text-align: center;
  }

  header {
    background-color: #fff;
    padding: 20px 0;
    border-bottom: 4px solid #ffc107;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  }

  header img { width: 90px; vertical-align: middle; }
  header h1 { display: inline-block; margin-left: 10px; color: #c8102e; font-size: 1.8rem; vertical-align: middle; }

  main { padding: 40px 20px; }
  .card {
    background: #ffffff;
    border-radius: 20px;
    display: inline-block;
    padding: 30px;
    width: 90%;
    max-width: 700px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.15);
    border-top: 6px solid #ffcc00;
    text-align: left;
  }

  .meta { text-align:center; margin-bottom: 10px; color:#777; font-size: .95rem }
  .section { font-weight: 700; color:#c8102e; margin-bottom: 8px; text-align:center; }
  .question { font-size: 1.2rem; font-weight: 600; color: #222; margin: 12px 0; text-align:center; }

  .sourceLine { text-align:center; color:#555; font-size:.9rem; margin-bottom:10px; }

  #userAnswer {
    width: calc(100% - 30px);
    padding: 12px;
    margin: 0 auto;
    display:block;
    border-radius:8px;
    border:2px solid #ddd;
    font-size:1rem;
  }

  .feedback { margin-top: 16px; padding: 14px; border-radius:10px; display:none; white-space:pre-wrap; }
  .correct { background:#e6ffed; color:#2e7d32; border-left:5px solid #2e7d32; }
  .incorrect { background:#ffe6e6; color:#b71c1c; border-left:5px solid #b71c1c; }

  .buttons { text-align:center; margin-top:16px; }
  button {
    margin: 8px;
    background: #c8102e;
    color: #fff;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-size: .98rem;
    font-weight: 700;
  }
  button.secondary { background:#555; }
  button:hover { filter:brightness(.95); }

  .progress { text-align:center; margin-top:10px; color:#555; font-size:.95rem; }

  footer { margin-top:30px; padding: 10px; font-size: 0.9rem; color: #555; text-align:center;}
</style>
</head>
<body>

<header>
  <img src="https://th.bing.com/th/id/R.466663e3e2b9cdbe29c5d4e0721ea9b7?rik=y%2b93vLaQvfidzg&riu=http%3a%2f%2fpngimg.com%2fuploads%2fmcdonalds%2fmcdonalds_PNG9.png&ehk=EcWIjy9En23IUg5CDObkhF0leLXrlb95DXKIAb%2fMM50%3d&risl=&pid=ImgRaw&r=0" alt="Logo" />
  <h1>Gu√≠a de estudio a entrenador MC</h1>
</header>

<main>
  <div class="card">
    <div class="meta">AutoMac</div>
    <div id="section" class="section">Presiona "Iniciar" para comenzar</div>
    <div id="question" class="question"></div>
    <div id="sourceLine" class="sourceLine"></div>

    <input id="userAnswer" type="text" placeholder="Escribe tu respuesta aqu√≠..." style="display:none;">

    <div id="feedback" class="feedback"></div>

    <div class="buttons">
      <button id="startBtn">Iniciar</button>
      <button id="checkBtn" style="display:none;">Comprobar</button>
      <button id="nextBtn" style="display:none;">Siguiente</button>
      <button id="restartBtn" class="secondary" style="display:none;">Reiniciar</button>
    </div>

    <div id="progress" class="progress"></div>
  </div>
</main>

<footer>
  ¬© 2025 Mc creador empleado 156372 Alexis Calderon | Proyecto de Entrenamiento MC üçü
</footer>

<script>
/* ---------- CONFIG ---------- */
const csvUrl = "https://raw.githubusercontent.com/alexc316/MC/main/Guia_de_entrenamiento_MC.csv";

/* ---------- ESTADO ---------- */
let rawRows = [];       // filas crudas del CSV
let data = [];          // array de objetos: {section, question, answer, source}
let randomized = [];
let currentIndex = 0;

/* ---------- UTIL: normalizar texto (quita may√∫sculas, acentos, puntuaci√≥n, espacios extras) ---------- */
function normalizeText(s) {
  if (!s) return "";
  // convertir a string, lowercase
  let t = String(s).toLowerCase().trim();
  // NFD + quitar marcas diacr√≠ticas (acentos)
  t = t.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
  // quitar caracteres que no sean letras, n√∫meros o espacios (puntuaci√≥n)
  t = t.replace(/[^\p{L}\p{N}\s]/gu, '');
  // colapsar espacios m√∫ltiples
  t = t.replace(/\s+/g, ' ').trim();
  return t;
}

/* ---------- UTIL: similitud simple por tokens (acepta si share ratio >= umbral o si uno incluye otro) ---------- */
function isSimilar(a, b) {
  const A = normalizeText(a);
  const B = normalizeText(b);
  if (!A || !B) return false;
  if (A === B) return true;
  if (A.includes(B) || B.includes(A)) return true;

  const wordsA = A.split(' ');
  const wordsB = B.split(' ');

  const setB = new Set(wordsB);
  let common = 0;
  for (const w of wordsA) if (setB.has(w)) common++;
  const ratio = common / Math.max(wordsA.length, wordsB.length);
  // umbral: 0.6 (60% palabras iguales) ‚Äî ajustable
  return ratio >= 0.6;
}

/* ---------- PARSE CSV robusto (detecta delimitador y mapea columnas por encabezado) ---------- */
async function loadCSV() {
  try {
    const res = await fetch(csvUrl);
    if (!res.ok) throw new Error('No se pudo obtener el CSV: ' + res.status);
    const raw = await res.text();
    const clean = raw.replace(/^\uFEFF/, '').trim();
    const delimiter = clean.includes(';') ? ';' : ',';
    const rows = clean.split(/\r?\n/).map(line =>
      line.split(new RegExp(`${delimiter}(?=(?:(?:[^"]*"){2})*[^"]*$)`)).map(cell => cell.replace(/(^"|"$)/g, '').trim())
    ).filter(r => r.length && !(r.length === 1 && !r[0]));

    if (rows.length < 2) throw new Error('CSV tiene menos de 2 filas');

    // encabezado: filas[0]
    const header = rows[0].map(h => h.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim());

    // buscar √≠ndices posibles
    const idx = {
      section: header.findIndex(h => /secci|section|categoria|area/.test(h)),
      question: header.findIndex(h => /pregunt|question|cuestio/.test(h)),
      answer: header.findIndex(h => /respuest|answer|soluci/.test(h)),
      source: header.findIndex(h => /fuente|source|origen/.test(h))
    };

    // si alguno no fue encontrado, intentar asignaciones por posici√≥n (fallback)
    if (idx.question === -1) idx.question = Math.max(0, header.indexOf('pregunta'), 1);
    if (idx.answer === -1) idx.answer = Math.max(1, header.indexOf('respuesta'), 2);
    if (idx.section === -1) idx.section = 0;
    if (idx.source === -1) idx.source = header.length - 1;

    // crear objetos
    data = rows.slice(1).map(r => ({
      section: r[idx.section] !== undefined ? r[idx.section] : '',
      question: r[idx.question] !== undefined ? r[idx.question] : '',
      answer: r[idx.answer] !== undefined ? r[idx.answer] : '',
      source: r[idx.source] !== undefined ? r[idx.source] : ''
    })).filter(d => d.question || d.answer); // filtrar vac√≠os

    if (data.length === 0) throw new Error('No se encontr√≥ contenido √∫til en el CSV.');

    console.log('Preguntas cargadas:', data.length);
    rawRows = rows;
    resetState();
  } catch (err) {
    console.error('Error cargando CSV:', err);
    document.getElementById('section').innerText = '‚ùå Error al cargar preguntas. Revisa la consola.';
    document.getElementById('question').innerText = '';
  }
}

/* ---------- CONTROL: shuffle y estado ---------- */
function shuffle(arr) {
  // Fisher-Yates
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function resetState() {
  randomized = shuffle(data);
  currentIndex = 0;
  // UI init
  document.getElementById('startBtn').style.display = 'inline-block';
  document.getElementById('checkBtn').style.display = 'none';
  document.getElementById('nextBtn').style.display = 'none';
  document.getElementById('restartBtn').style.display = 'none';
  document.getElementById('userAnswer').style.display = 'none';
  document.getElementById('feedback').style.display = 'none';
  document.getElementById('section').innerText = 'Presiona "Iniciar" para comenzar';
  document.getElementById('question').innerText = '';
  document.getElementById('sourceLine').innerText = '';
  document.getElementById('progress').innerText = '';
}

/* ---------- Mostrar pregunta actual (muestra secci√≥n, pregunta y fuente) ---------- */
function showCurrent() {
  if (currentIndex >= randomized.length) {
    document.getElementById('section').innerText = 'üéâ ¬°Has terminado todas las preguntas!';
    document.getElementById('question').innerText = '';
    document.getElementById('sourceLine').innerText = '';
    document.getElementById('userAnswer').style.display = 'none';
    document.getElementById('checkBtn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'none';
    document.getElementById('restartBtn').style.display = 'inline-block';
    document.getElementById('progress').innerText = `Terminaste ${randomized.length} preguntas.`;
    return;
  }

  const item = randomized[currentIndex];
  document.getElementById('section').innerText = item.section || 'Sin secci√≥n';
  document.getElementById('question').innerText = item.question || 'Sin pregunta';
  // Mostrar la fuente en la parte superior (si quieres que aparezca solo en feedback, quitar esta l√≠nea)
  document.getElementById('sourceLine').innerText = item.source ? `Fuente: ${item.source}` : '';

  document.getElementById('userAnswer').value = '';
  document.getElementById('userAnswer').style.display = 'block';
  document.getElementById('feedback').style.display = 'none';
  document.getElementById('checkBtn').style.display = 'inline-block';
  document.getElementById('nextBtn').style.display = 'none';
  document.getElementById('restartBtn').style.display = 'inline-block'; // disponible en todo momento
  document.getElementById('progress').innerText = `Pregunta ${currentIndex + 1} de ${randomized.length}`;
}

/* ---------- Verificar respuesta ---------- */
function checkAnswer() {
  if (currentIndex >= randomized.length) return;
  const item = randomized[currentIndex];
  const user = document.getElementById('userAnswer').value;
  const correct = item.answer || '';
  const source = item.source || 'Sin fuente';

  const ok = isSimilar(user, correct);

  const fb = document.getElementById('feedback');
  fb.style.display = 'block';
  if (ok) {
    fb.className = 'feedback correct';
    fb.innerText = `‚úÖ Correcto.\nFuente: ${source}`;
  } else {
    fb.className = 'feedback incorrect';
    fb.innerText = `‚ùå Incorrecto.\nRespuesta esperada: ${correct}\nFuente: ${source}`;
  }

  // Mostrar siguiente
  document.getElementById('nextBtn').style.display = 'inline-block';
  document.getElementById('checkBtn').style.display = 'none';
}

/* ---------- Eventos UI ---------- */
document.getElementById('startBtn').addEventListener('click', () => {
  if (data.length === 0) {
    alert('A√∫n no se cargaron las preguntas o el CSV est√° vac√≠o.');
    return;
  }
  randomized = shuffle(data);
  currentIndex = 0;
  document.getElementById('startBtn').style.display = 'none';
  showCurrent();
});

document.getElementById('checkBtn').addEventListener('click', () => {
  checkAnswer();
});

document.getElementById('nextBtn').addEventListener('click', () => {
  currentIndex++;
  showCurrent();
});

document.getElementById('restartBtn').addEventListener('click', () => {
  resetState();
  randomized = shuffle(data);
  currentIndex = 0;
  document.getElementById('startBtn').style.display = 'inline-block';
});

/* ---------- Inicio: cargar CSV ---------- */
loadCSV();
</script>
</body>
</html>
