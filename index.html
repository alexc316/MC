<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Gu√≠a de estudio a entrenador MC</title>
<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(to bottom right, #fffdf5, #fff);
    color: #222;
    text-align: center;
  }

  header {
    background-color: #fff;
    padding: 20px 0;
    border-bottom: 4px solid #ffc107;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  }

  header img { width: 90px; vertical-align: middle; }
  header h1 { display: inline-block; margin-left: 10px; color: #c8102e; font-size: 1.8rem; vertical-align: middle; }

  main { padding: 40px 20px; }
  .card {
    background: #ffffff;
    border-radius: 20px;
    display: inline-block;
    padding: 30px;
    width: 90%;
    max-width: 700px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.15);
    border-top: 6px solid #ffcc00;
    text-align: left;
  }

  .meta { text-align:center; margin-bottom: 10px; color:#777; font-size: .95rem }
  .section { font-weight: 700; color:#c8102e; margin-bottom: 8px; text-align:center; }
  .question { font-size: 1.2rem; font-weight: 600; color: #222; margin: 12px 0; text-align:center; }

  .sourceLine { text-align:center; color:#555; font-size:.9rem; margin-bottom:10px; }

  #userAnswer {
    width: calc(100% - 30px);
    padding: 12px;
    margin: 0 auto;
    display:block;
    border-radius:8px;
    border:2px solid #ddd;
    font-size:1rem;
  }

  .feedback { margin-top: 16px; padding: 14px; border-radius:10px; display:none; white-space:pre-wrap; }
  .correct { background:#e6ffed; color:#2e7d32; border-left:5px solid #2e7d32; }
  .incorrect { background:#ffe6e6; color:#b71c1c; border-left:5px solid #b71c1c; }

  .buttons { text-align:center; margin-top:16px; }
  button {
    margin: 8px;
    background: #c8102e;
    color: #fff;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-size: .98rem;
    font-weight: 700;
  }
  button.secondary { background:#555; }
  button.warning { background:#ffcc00; color:#222; }
  button:hover { filter:brightness(.95); }

  .progress { text-align:center; margin-top:10px; color:#555; font-size:.95rem; }

  footer { margin-top:30px; padding: 10px; font-size: 0.9rem; color: #555; text-align:center;}
</style>
</head>
<body>

<header>
  <img src="https://th.bing.com/th/id/R.466663e3e2b9cdbe29c5d4e0721ea9b7?rik=y%2b93vLaQvfidzg&riu=http%3a%2f%2fpngimg.com%2fuploads%2fmcdonalds%2fmcdonalds_PNG9.png&ehk=EcWIjy9En23IUg5CDObkhF0leLXrlb95DXKIAb%2fMM50%3d&risl=&pid=ImgRaw&r=0" alt="Logo" />
  <h1>Gu√≠a de estudio a entrenador MC</h1>
</header>

<main>
  <div class="card">
    <div class="meta">AutoMac</div>
    <div id="section" class="section">Presiona "Iniciar" para comenzar</div>
    <div id="question" class="question"></div>
    <div id="sourceLine" class="sourceLine"></div>

    <input id="userAnswer" type="text" placeholder="Escribe tu respuesta aqu√≠..." style="display:none;">

    <div id="feedback" class="feedback"></div>

    <div class="buttons">
      <button id="startBtn">Iniciar</button>
      <button id="checkBtn" style="display:none;">Comprobar</button>
      <button id="nextBtn" style="display:none;">Siguiente</button>
      <button id="finishBtn" class="warning" style="display:none;">Terminar</button>
      <button id="restartBtn" class="secondary" style="display:none;">Reiniciar</button>
    </div>

    <div id="progress" class="progress"></div>
  </div>
</main>

<footer>
  ¬© 2025 Mc creador empleado 156372 Alexis Calderon | Proyecto de Entrenamiento MC üçü
</footer>

<script>
const csvUrl = "https://raw.githubusercontent.com/alexc316/MC/main/Guia_de_entrenamiento_MC.csv";

let data = [];
let randomized = [];
let currentIndex = 0;
let correctCount = 0;
let wrongCount = 0;

function normalizeText(s) {
  if (!s) return "";
  let t = String(s).toLowerCase().trim();
  t = t.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
  t = t.replace(/[^\p{L}\p{N}\s]/gu, '');
  t = t.replace(/\s+/g, ' ').trim();
  return t;
}

function isSimilar(a, b) {
  const A = normalizeText(a);
  const B = normalizeText(b);
  if (!A || !B) return false;
  if (A === B || A.includes(B) || B.includes(A)) return true;
  const wordsA = A.split(' ');
  const wordsB = B.split(' ');
  const setB = new Set(wordsB);
  let common = 0;
  for (const w of wordsA) if (setB.has(w)) common++;
  return (common / Math.max(wordsA.length, wordsB.length)) >= 0.6;
}

async function loadCSV() {
  const res = await fetch(csvUrl);
  const raw = await res.text();
  const clean = raw.replace(/^\uFEFF/, '').trim();
  const delimiter = clean.includes(';') ? ';' : ',';
  const rows = clean.split(/\r?\n/).map(line =>
    line.split(new RegExp(`${delimiter}(?=(?:(?:[^"]*"){2})*[^"]*$)`)).map(cell => cell.replace(/(^"|"$)/g, '').trim())
  );
  const header = rows[0].map(h => h.toLowerCase());
  const idx = {
    section: header.findIndex(h => /secci/.test(h)),
    question: header.findIndex(h => /pregunt/.test(h)),
    answer: header.findIndex(h => /respuest/.test(h)),
    source: header.findIndex(h => /fuente|source/.test(h))
  };
  data = rows.slice(1).map(r => ({
    section: r[idx.section] || '',
    question: r[idx.question] || '',
    answer: r[idx.answer] || '',
    source: r[idx.source] || ''
  })).filter(d => d.question && d.answer);
  resetState();
}

function shuffle(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function resetState() {
  randomized = shuffle(data);
  currentIndex = 0;
  correctCount = 0;
  wrongCount = 0;
  document.getElementById('startBtn').style.display = 'inline-block';
  document.getElementById('checkBtn').style.display = 'none';
  document.getElementById('nextBtn').style.display = 'none';
  document.getElementById('finishBtn').style.display = 'none';
  document.getElementById('restartBtn').style.display = 'none';
  document.getElementById('userAnswer').style.display = 'none';
  document.getElementById('feedback').style.display = 'none';
  document.getElementById('section').innerText = 'Presiona "Iniciar" para comenzar';
  document.getElementById('question').innerText = '';
  document.getElementById('sourceLine').innerText = '';
  document.getElementById('progress').innerText = '';
}

function showCurrent() {
  if (currentIndex >= randomized.length) return showResults();
  const item = randomized[currentIndex];
  document.getElementById('section').innerText = item.section;
  document.getElementById('question').innerText = item.question;
  document.getElementById('sourceLine').innerText = item.source ? `Fuente: ${item.source}` : '';
  document.getElementById('userAnswer').value = '';
  document.getElementById('userAnswer').style.display = 'block';
  document.getElementById('feedback').style.display = 'none';
  document.getElementById('checkBtn').style.display = 'inline-block';
  document.getElementById('nextBtn').style.display = 'none';
  document.getElementById('finishBtn').style.display = 'inline-block';
  updateProgress();
}

function updateProgress() {
  document.getElementById('progress').innerText =
    `Pregunta ${currentIndex + 1} de ${randomized.length} | ‚úÖ ${correctCount} correctas | ‚ùå ${wrongCount} incorrectas`;
}

function checkAnswer() {
  const item = randomized[currentIndex];
  const user = document.getElementById('userAnswer').value;
  const ok = isSimilar(user, item.answer);
  const fb = document.getElementById('feedback');
  fb.style.display = 'block';
  if (ok) {
    correctCount++;
    fb.className = 'feedback correct';
    fb.innerText = `‚úÖ Correcto.\nFuente: ${item.source || 'Sin fuente'}`;
  } else {
    wrongCount++;
    fb.className = 'feedback incorrect';
    fb.innerText = `‚ùå Incorrecto.\nRespuesta: ${item.answer}\nFuente: ${item.source || 'Sin fuente'}`;
  }
  document.getElementById('checkBtn').style.display = 'none';
  document.getElementById('nextBtn').style.display = 'inline-block';
  updateProgress();
}

function showResults() {
  const total = correctCount + wrongCount;
  const totalQuestions = randomized.length;
  const comment =
    correctCount / totalQuestions >= 0.9
      ? "¬°Excelente trabajo! Eres un experto üçü"
      : correctCount / totalQuestions >= 0.7
      ? "¬°Muy bien! Solo unos detalles por pulir üëè"
      : "Sigue practicando, vas por buen camino üí™";

  document.getElementById('section').innerText = "Resumen final";
  document.getElementById('question').innerText =
    `Completaste ${total} de ${totalQuestions} preguntas.\n‚úÖ Correctas: ${correctCount}\n‚ùå Incorrectas: ${wrongCount}`;
  document.getElementById('sourceLine').innerText = comment;
  document.getElementById('userAnswer').style.display = 'none';
  document.getElementById('feedback').style.display = 'none';
  document.getElementById('checkBtn').style.display = 'none';
  document.getElementById('nextBtn').style.display = 'none';
  document.getElementById('finishBtn').style.display = 'none';
  document.getElementById('restartBtn').style.display = 'inline-block';
  updateProgress();
}

document.getElementById('startBtn').addEventListener('click', () => {
  randomized = shuffle(data);
  currentIndex = 0;
  correctCount = 0;
  wrongCount = 0;
  document.getElementById('startBtn').style.display = 'none';
  showCurrent();
});

document.getElementById('checkBtn').addEventListener('click', checkAnswer);

document.getElementById('nextBtn').addEventListener('click', () => {
  currentIndex++;
  if (currentIndex >= randomized.length) showResults();
  else showCurrent();
});

document.getElementById('finishBtn').addEventListener('click', () => {
  const remaining = randomized.length - (currentIndex + 1);
  if (remaining > 0) {
    const confirmEnd = confirm(`¬øSeguro que quieres terminar? A√∫n faltan ${remaining} preguntas.`);
    if (!confirmEnd) return;
  }
  showResults();
});

document.getElementById('restartBtn').addEventListener('click', resetState);

loadCSV();
</script>
</body>
</html>
